<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NC GOTV Web App PRD — Data & Architecture</title>
    <style>
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            line-height: 1.7;
            margin: 0;
            padding: 0;
            background: #f5f5ff;
            color: #1d2136;
        }
        header {
            background: #2d2361;
            color: #f5f1ff;
            padding: 2.5rem 1.25rem 2rem;
            text-align: center;
        }
        main {
            max-width: 940px;
            margin: 0 auto;
            padding: 2.75rem 1.5rem 3.5rem;
            background: white;
            box-shadow: 0 20px 48px rgba(45, 35, 97, 0.12);
        }
        h1, h2, h3, h4 {
            font-family: "Merriweather", Georgia, serif;
        }
        h2 {
            color: #2d2361;
            margin-top: 2.5rem;
        }
        h3 {
            color: #443499;
            margin-top: 1.75rem;
        }
        h4 {
            color: #5a4bc7;
            margin-top: 1.25rem;
        }
        p {
            margin: 1rem 0;
        }
        ul {
            margin: 0.75rem 0 1.5rem 1.25rem;
        }
        nav {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
            margin-top: 1.5rem;
        }
        nav a {
            background: rgba(245, 241, 255, 0.2);
            border: 1px solid rgba(245, 241, 255, 0.45);
            color: #f5f1ff;
            padding: 0.5rem 1.1rem;
            border-radius: 999px;
            text-decoration: none;
            font-size: 0.95rem;
        }
        nav a[aria-current="page"] {
            background: #f5f1ff;
            color: #2d2361;
        }
        nav a:hover,
        nav a:focus {
            background: #f5f1ff;
            color: #2d2361;
            outline: none;
        }
        .callout {
            border-left: 4px solid #5a4bc7;
            background: #f0edff;
            padding: 1.2rem 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }
        .table-like {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .table-like div {
            background: #faf9ff;
            border: 1px solid rgba(45, 35, 97, 0.1);
            border-radius: 8px;
            padding: 1rem 1.25rem;
        }
        code, pre {
            font-family: "Source Code Pro", monospace;
        }
        pre {
            background: #11142b;
            color: #f5f1ff;
            border-radius: 8px;
            padding: 1rem;
            overflow-x: auto;
        }
        .footer-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
            gap: 1rem;
        }
        .footer-nav a {
            color: #2d2361;
            text-decoration: none;
            font-weight: 600;
        }
        .breadcrumbs {
            font-size: 0.9rem;
            margin-bottom: 1.25rem;
        }
        .breadcrumbs a {
            color: #f5f1ff;
            text-decoration: none;
        }
        @media (max-width: 720px) {
            main {
                margin: 0 1rem;
            }
            .footer-nav {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="breadcrumbs"><a href="../index.html">← Back to DECEC</a></div>
        <h1>Data Sources &amp; Architecture</h1>
        <p>Authoritative data sets, integration cadence, stack recommendations, and security practices that underpin the NC GOTV Web App.</p>
        <nav aria-label="PRD sections">
            <a href="index.html">Overview</a>
            <a href="goals-personas.html">Goals &amp; Personas</a>
            <a href="phase-details.html">Phase Details</a>
            <a href="data-architecture.html" aria-current="page">Data &amp; Architecture</a>
            <a href="ux-metrics.html">UX, Metrics &amp; Risks</a>
        </nav>
    </header>
    <main>
        <section>
            <h2>Authoritative Data Sources</h2>
            <div class="table-like">
                <div>
                    <h3>NC Voter Registration (weekly)</h3>
                    <p>Primary demographic, status, party, address, precinct, and district data. Sensitive fields (SSN, DOB) are excluded per state rules.</p>
                </div>
                <div>
                    <h3>NC Voter History (weekly)</h3>
                    <p>Event-level participation records including election identifiers, method, and party at vote. Must be joined back to registration data via <code>ncid</code>.</p>
                </div>
                <div>
                    <h3>Polling Places &amp; Early Voting Sites</h3>
                    <p>Election-specific CSVs that map precincts to locations and hours; support Phase 2 precinct exports and maps.</p>
                </div>
                <div>
                    <h3>Precinct Shapefiles</h3>
                    <p>Current and historical polygons used for mapping precinct boundaries and tying voters to geographic context.</p>
                </div>
                <div>
                    <h3>AddressNC Address Points</h3>
                    <p>Statewide standardized addresses that enable Phase 3 set-difference analysis to uncover likely unregistered households.</p>
                </div>
            </div>
        </section>
        <section>
            <h2>Recommended Architecture</h2>
            <div class="callout">
                <h3>Frontend</h3>
                <p>React or Svelte single-page application with accessible data tables and MapLibre/Leaflet for precinct visualization.</p>
                <h3>Backend</h3>
                <p>Python (FastAPI) or Node (Fastify) serving search, filter, and export endpoints backed by PostgreSQL 15+ with PostGIS and <code>pg_trgm</code>.</p>
                <h3>Jobs &amp; Pipelines</h3>
                <p>Airflow or cron-driven ingestion, dbt transformations, and object storage for raw drops. Exports delivered via pre-signed URLs and async jobs for large payloads.</p>
            </div>
        </section>
        <section>
            <h2>Indexing &amp; Performance</h2>
            <ul>
                <li>Create GIN indexes on trigram-enabled name columns to power fuzzy search.</li>
                <li>Use B-tree indexes on county, precinct, and status to accelerate filters.</li>
                <li>Introduce partial indexes scoped to Halifax initially, expanding statewide later.</li>
            </ul>
        </section>
        <section>
            <h2>Security &amp; Privacy</h2>
            <ul>
                <li>Enforce HTTPS, IP rate limiting, audit logging, and least-privilege database roles.</li>
                <li>Display terms banner emphasizing non-commercial political use and PII handling policies.</li>
                <li>Allow exports to omit sensitive columns when organizers need to limit field exposure.</li>
            </ul>
        </section>
        <section>
            <h2>Example SQL References</h2>
            <p>Sample queries illustrate fuzzy search, history filtering, and address set differences.</p>
<pre><code>-- Fuzzy name candidate set (Halifax only)
SELECT v.ncid, v.first_name, v.last_name, v.party, v.status, v.precinct_code,
       similarity((v.first_name||' '||v.last_name), $1) AS sim
FROM voter v
WHERE v.county_id = 'HALIFAX'
  AND (v.first_name||' '||v.last_name) % $1
ORDER BY sim DESC
LIMIT 200;

-- History filter (voted in 2020_G, not 2022_G)
WITH voted AS (
  SELECT ncid,
         MAX(CASE WHEN election_id = '2020_G' THEN 1 END) has20,
         MAX(CASE WHEN election_id = '2022_G' THEN 1 END) has22
  FROM voter_history
  GROUP BY ncid
)
SELECT v.*
FROM voter v
JOIN voted h USING (ncid)
WHERE h.has20 = 1
  AND COALESCE(h.has22, 0) = 0
  AND v.county_id = 'HALIFAX';

-- Address set difference for likely unregistered households
SELECT a.*
FROM addressnc a
LEFT JOIN (
  SELECT DISTINCT canonical_address_key
  FROM voter
) r ON a.canonical_address_key = r.canonical_address_key
WHERE r.canonical_address_key IS NULL
  AND a.county_id = 'HALIFAX';
</code></pre>
        </section>
        <section class="footer-nav">
            <a href="phase-details.html">← Back to Phase Details</a>
            <a href="ux-metrics.html">Next: UX, Metrics &amp; Risks →</a>
        </section>
    </main>
</body>
</html>
